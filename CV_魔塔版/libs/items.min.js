function items(){this.init()}items.prototype.init=function(){this.items=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.items;this.itemEffect=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.itemEffect;this.itemEffectTip=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.itemEffectTip;this.useItemEffect=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.useItemEffect;this.canUseItemEffect=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.canUseItemEffect};items.prototype.getItems=function(){return this.items};items.prototype.getItemEffect=function(itemId,itemNum){var itemCls=core.material.items[itemId].cls;if(itemCls==="items"){var ratio=parseInt(core.status.thisMap.item_ratio)||1;var curr_hp=core.status.hero.hp;if(itemId in this.itemEffect){eval(this.itemEffect[itemId])}core.status.hero.statistics.hp+=core.status.hero.hp-curr_hp}else{core.addItem(itemId,itemNum)}};items.prototype.getItemEffectTip=function(itemId){var itemCls=core.material.items[itemId].cls;if(itemCls==="items"){var ratio=parseInt(core.status.thisMap.item_ratio)||1;if(itemId in this.itemEffectTip){return eval(this.itemEffectTip[itemId])||""}}return""};items.prototype.useItem=function(itemId,callback){if(!this.canUseItem(itemId)){if(core.isset(callback)){callback()}return}var itemCls=core.material.items[itemId].cls;if(itemId in this.useItemEffect){eval(this.useItemEffect[itemId])}if(itemId!="book"&&itemId!="fly"){core.status.route.push("item:"+itemId)}if(itemCls=="tools"){core.status.hero.items[itemCls][itemId]--}if(core.status.hero.items[itemCls][itemId]==0){delete core.status.hero.items[itemCls][itemId]}core.updateStatusBar();if(core.isset(callback)){callback()}};items.prototype.canUseItem=function(itemId){if(!core.hasItem(itemId)){return false}if(itemId in this.canUseItemEffect){return eval(this.canUseItemEffect[itemId])}return false};items.prototype.itemCount=function(b){if(!core.isset(b)||!core.isset(core.material.items[b])){return 0}var a=core.material.items[b].cls;if(a=="items"){return 0}return core.isset(core.status.hero.items[a][b])?core.status.hero.items[a][b]:0};items.prototype.hasItem=function(a){return core.itemCount(a)>0};items.prototype.hasEquip=function(a){if(!core.isset(a)){return null}if(!core.isset((core.material.items[a]||{}).equip)){return null}return a==this.getEquip(core.material.items[a].equip.type)};items.prototype.getEquip=function(a){return(core.status.hero.equipment||[])[a]||null};items.prototype.setItem=function(b,c){c=c||0;if(c<=0){c=0}var a=core.material.items[b].cls;if(a=="items"){return}if(!core.isset(core.status.hero.items[a])){core.status.hero.items[a]={}}core.status.hero.items[a][b]=c;if(a!="keys"&&c==0){delete core.status.hero.items[a][b]}};items.prototype.removeItem=function(b,c){c=c||1;if(!core.hasItem(b)){return false}var a=core.material.items[b].cls;core.status.hero.items[a][b]-=c;if(a!="keys"&&core.status.hero.items[a][b]<=0){delete core.status.hero.items[a][b]}core.updateStatusBar();return true};items.prototype.addItem=function(c,d){d=d||1;var b=core.material.items[c];var a=b.cls;if(a=="items"){return}if(!core.isset(core.status.hero.items[a])){core.status.hero.items[a]={};core.status.hero.items[a][c]=0}else{if(!core.isset(core.status.hero.items[a][c])){core.status.hero.items[a][c]=0}}core.status.hero.items[a][c]+=d;if(a=="constants"&&core.status.hero.items[a][c]>1){core.status.hero.items[a][c]=1}};items.prototype.loadEquip=function(b,a){if(!core.isset(core.status.hero.equipment)){core.status.hero.equipment=[]}core.playSound("equip.mp3");var c=core.material.items[b];if(!core.isset(c)){if(core.isset(a)){a()}return}var d=c.equip.type;var f=core.status.hero.equipment[d];var e=core.compareEquipment(b,f);if(core.flags.equipPercentage){core.setFlag("equip_atk_buff",core.getFlag("equip_atk_buff",1)+e.atk/100);core.setFlag("equip_def_buff",core.getFlag("equip_def_buff",1)+e.def/100);core.setFlag("equip_mdef_buff",core.getFlag("equip_mdef_buff",1)+e.mdef/100)}else{core.status.hero.atk+=e.atk;core.status.hero.def+=e.def;core.status.hero.mdef+=e.mdef}core.status.hero.equipment[d]=b;core.updateStatusBar();core.removeItem(b);if(core.isset(f)){core.addItem(f,1)}core.drawTip("已装备上"+c.name,core.material.icons.items[b]);if(core.isset(a)){a()}};items.prototype.unloadEquip=function(b,a){if(!core.isset(core.status.hero.equipment)){core.status.hero.equipment=[]}core.playSound("equip.mp3");var d=core.status.hero.equipment[b];if(!core.isset(d)){if(core.isset(a)){a()}return}var c=core.material.items[d];if(core.flags.equipPercentage){core.setFlag("equip_atk_buff",core.getFlag("equip_atk_buff",1)-(c.equip.atk||0)/100);core.setFlag("equip_def_buff",core.getFlag("equip_def_buff",1)-(c.equip.def||0)/100);core.setFlag("equip_mdef_buff",core.getFlag("equip_mdef_buff",1)-(c.equip.mdef||0)/100)}else{core.status.hero.atk-=c.equip.atk||0;core.status.hero.def-=c.equip.def||0;core.status.hero.mdef-=c.equip.mdef||0}core.status.hero.equipment[b]=null;core.updateStatusBar();core.addItem(d,1);core.drawTip("已卸下"+c.name,core.material.icons.items[d]);if(core.isset(a)){a()}};items.prototype.compareEquipment=function(f,b){var c=0,d=0,g=0;if(core.isset(f)){var e=core.material.items[f];c+=(e.equip||{}).atk||0;d+=(e.equip||{}).def||0;g+=(e.equip||{}).mdef||0}if(core.isset(b)){var a=core.material.items[b];c-=(a.equip||{}).atk||0;d-=(a.equip||{}).def||0;g-=(a.equip||{}).mdef||0}return{atk:c,def:d,mdef:g}};