function actions(){this.init()}actions.prototype.init=function(){};actions.prototype.onkeyDown=function(a){if(core.isset(core.status.replay)&&core.status.replay.replaying&&core.status.event.id!="save"&&(core.status.event.id||"").indexOf("book")!=0&&core.status.event.id!="viewMaps"){return}if(!core.isset(core.status.holdingKeys)){core.status.holdingKeys=[]}var c={37:true,38:true,39:true,40:true}[a.keyCode];if(c&&!core.status.lockControl){for(var b=0;b<core.status.holdingKeys.length;b++){if(core.status.holdingKeys[b]===a.keyCode){return}}core.status.holdingKeys.push(a.keyCode);this.pressKey(a.keyCode)}else{if(a.keyCode==17){core.status.ctrlDown=true}this.keyDown(a.keyCode)}};actions.prototype.onkeyUp=function(a){if(core.isset(core.status.replay)&&core.status.replay.replaying&&core.status.event.id!="save"&&(core.status.event.id||"").indexOf("book")!=0&&core.status.event.id!="viewMaps"){if(a.keyCode==27){core.stopReplay()}else{if(a.keyCode==90){core.speedDownReplay()}else{if(a.keyCode==88){core.speedUpReplay()}else{if(a.keyCode==32){core.triggerReplay()}else{if(a.keyCode==65){core.rewindReplay()}else{if(a.keyCode==83){core.saveReplay()}else{if(a.keyCode==67){core.bookReplay()}else{if(a.keyCode==33||a.keyCode==34){core.viewMapReplay()}else{if(a.keyCode>=49&&a.keyCode<=51){core.setReplaySpeed(a.keyCode-48)}else{if(a.keyCode==52){core.setReplaySpeed(6)}else{if(a.keyCode==53){core.setReplaySpeed(12)}else{if(a.keyCode==54){core.setReplaySpeed(24)}}}}}}}}}}}}return}var c={37:true,38:true,39:true,40:true}[a.keyCode];if(c&&!core.status.lockControl){for(var b=0;b<core.status.holdingKeys.length;b++){if(core.status.holdingKeys[b]===a.keyCode){core.status.holdingKeys=core.status.holdingKeys.slice(0,b).concat(core.status.holdingKeys.slice(b+1));if(b===core.status.holdingKeys.length&&core.status.holdingKeys.length!==0){core.pressKey(core.status.holdingKeys.slice(-1)[0])}break}}this.keyUp(a.keyCode)}else{if(a.keyCode==17){core.status.ctrlDown=false}this.keyUp(a.keyCode)}};actions.prototype.pressKey=function(a){if(core.isset(core.status.replay)&&core.status.replay.replaying&&core.status.event.id!="save"&&(core.status.event.id||"").indexOf("book")!=0){return}if(a===core.status.holdingKeys.slice(-1)[0]){this.keyDown(a);window.setTimeout(function(){core.pressKey(a)},30)}};actions.prototype.keyDown=function(a){if(core.isset(core.status.replay)&&core.status.replay.replaying&&core.status.event.id!="save"&&(core.status.event.id||"").indexOf("book")!=0&&core.status.event.id!="viewMaps"){return}if(core.status.lockControl){if(a==17){this.keyDownCtrl();return}if(core.status.event.id=="action"){this.keyDownAction(a);return}if(core.status.event.id=="book"){this.keyDownBook(a);return}if(core.status.event.id=="fly"){this.keyDownFly(a);return}if(core.status.event.id=="viewMaps"){this.keyDownViewMaps(a);return}if(core.status.event.id=="shop"){this.keyDownShop(a);return}if(core.status.event.id=="selectShop"){this.keyDownQuickShop(a);return}if(core.status.event.id=="equipbox"){this.keyDownEquipbox(a);return}if(core.status.event.id=="toolbox"){this.keyDownToolbox(a);return}if(core.status.event.id=="save"||core.status.event.id=="load"||core.status.event.id=="replayLoad"){this.keyDownSL(a);return}if(core.status.event.id=="switchs"){this.keyDownSwitchs(a);return}if(core.status.event.id=="settings"){this.keyDownSettings(a);return}if(core.status.event.id=="syncSave"){this.keyDownSyncSave(a);return}if(core.status.event.id=="syncSelect"){this.keyDownSyncSelect(a);return}if(core.status.event.id=="localSaveSelect"){this.keyDownLocalSaveSelect(a);return}if(core.status.event.id=="storageRemove"){this.keyDownStorageRemove(a);return}if(core.status.event.id=="cursor"){this.keyDownCursor(a);return}if(core.status.event.id=="replay"){this.keyDownReplay(a)}return}if(!core.status.played){return}switch(a){case 37:core.moveHero("left");break;case 38:core.moveHero("up");break;case 39:core.moveHero("right");break;case 40:core.moveHero("down");break;break}};actions.prototype.keyUp=function(a){if(core.isset(core.status.replay)&&core.status.replay.replaying&&core.status.event.id!="save"&&(core.status.event.id||"").indexOf("book")!=0&&core.status.event.id!="viewMaps"){return}if(core.status.lockControl){core.status.holdingKeys=[];if(core.status.event.id=="text"&&(a==13||a==32||a==67)){core.drawText();return}if(core.status.event.id=="confirmBox"){this.keyUpConfirmBox(a);return}if(core.status.event.id=="action"){this.keyUpAction(a);return}if(core.status.event.id=="about"&&(a==13||a==32||a==67)){this.clickAbout();return}if(core.status.event.id=="book"){this.keyUpBook(a);return}if(core.status.event.id=="book-detail"&&(a==13||a==32||a==67)){this.clickBookDetail();return}if(core.status.event.id=="fly"){this.keyUpFly(a);return}if(core.status.event.id=="viewMaps"){this.keyUpViewMaps(a);return}if(core.status.event.id=="shop"){this.keyUpShop(a);return}if(core.status.event.id=="selectShop"){this.keyUpQuickShop(a);return}if(core.status.event.id=="toolbox"){this.keyUpToolbox(a);return}if(core.status.event.id=="equipbox"){this.keyUpEquipbox(a);return}if(core.status.event.id=="save"||core.status.event.id=="load"||core.status.event.id=="replayLoad"){this.keyUpSL(a);return}if(core.status.event.id=="switchs"){this.keyUpSwitchs(a);return}if(core.status.event.id=="settings"){this.keyUpSettings(a);return}if(core.status.event.id=="syncSave"){this.keyUpSyncSave(a);return}if(core.status.event.id=="syncSelect"){this.keyUpSyncSelect(a);return}if(core.status.event.id=="localSaveSelect"){this.keyUpLocalSaveSelect(a);return}if(core.status.event.id=="storageRemove"){this.keyUpStorageRemove(a);return}if(core.status.event.id=="cursor"){this.keyUpCursor(a);return}if(core.status.event.id=="replay"){this.keyUpReplay(a);return}if(core.status.event.id=="centerFly"){this.keyUpCenterFly(a);return}return}if(!core.status.played){return}switch(a){case 27:if(core.status.heroStop){core.openSettings(true)}break;case 71:if(core.status.heroStop){core.useFly(true)}break;case 81:if(core.status.heroStop){core.openEquipbox(true)}break;case 88:if(core.status.heroStop){core.openBook(true)}break;case 65:if(core.status.heroStop){core.doSL("autoSave","load")}break;case 66:if(core.status.heroStop){core.ui.drawStatistics()}break;case 83:if(core.status.heroStop){core.save(true)}break;case 68:if(core.status.heroStop){core.load(true)}break;case 69:if(core.status.heroStop){core.ui.drawCursor()}break;case 84:if(core.status.heroStop){core.openToolbox(true)}break;case 90:if(core.status.heroStop){core.turnHero()}break;case 75:case 86:if(core.status.heroStop){core.openQuickShop(true)}break;case 32:if(core.status.heroStop){core.getNextItem()}break;case 72:if(core.status.heroStop){core.ui.drawHelp()}break;case 82:if(core.status.heroStop){if(core.hasFlag("debug")){core.drawText("\t[系统提示]调试模式下无法回放录像")}else{core.ui.drawReplay()}}break;case 33:case 34:if(core.status.heroStop){if(core.flags.enableViewMaps){core.ui.drawMaps()}else{core.drawTip("本塔不允许浏览地图！")}}break;case 37:break;case 38:break;case 39:break;case 40:break;case 49:if(core.status.heroStop&&core.hasItem("pickaxe")){if(core.canUseItem("pickaxe")){core.useItem("pickaxe")}else{core.drawTip("当前不能使用破墙镐")}}break;case 50:if(core.status.heroStop){if(core.hasItem("bomb")){if(core.canUseItem("bomb")){core.useItem("bomb")}else{core.drawTip("当前不能使用炸弹")}}else{if(core.hasItem("hammer")){if(core.canUseItem("hammer")){core.useItem("hammer")}else{core.drawTip("当前不能使用圣锤")}}}}break;case 51:if(core.status.heroStop&&core.hasItem("centerFly")){core.events.useItem("centerFly")}break}if(core.isset(core.status.automaticRoute)&&core.status.automaticRoute.autoHeroMove){core.stopAutomaticRoute()}core.stopHero()};actions.prototype.ondown=function(b,c){if(core.isset(core.status.replay)&&core.status.replay.replaying&&core.status.event.id!="save"&&(core.status.event.id||"").indexOf("book")!=0&&core.status.event.id!="viewMaps"){return}if(!core.status.played||core.status.lockControl){this.onclick(b,c,[]);if(core.timeout.onDownTimeout==null){core.timeout.onDownTimeout=setTimeout(function(){if(core.interval.onDownInterval==null){core.interval.onDownInterval=setInterval(function(){if(!core.actions.longClick(b,c,true)){clearInterval(core.interval.onDownInterval);core.interval.onDownInterval=null}},40)}},500)}return}core.status.downTime=new Date();core.clearMap("route");var a={x:b,y:c};core.status.stepPostfix=[];core.status.stepPostfix.push(a);core.fillPosWithPoint(a)};actions.prototype.onmove=function(g,h){if(core.isset(core.status.replay)&&core.status.replay.replaying&&core.status.event.id!="save"&&(core.status.event.id||"").indexOf("book")!=0&&core.status.event.id!="viewMaps"){return}var e={x:g,y:h};var f=core.status.stepPostfix[core.status.stepPostfix.length-1];var a=[e.y-f.y,f.x-e.x,f.y-e.y,e.x-f.x];var d=0,c=4;for(var b=0;b<4;b++){if(a[b]>d){c=b;d=a[b]}}e=[{x:0,y:1},{x:-1,y:0},{x:0,y:-1},{x:1,y:0},false][c];if(e){e.x+=f.x;e.y+=f.y;core.status.stepPostfix.push(e);core.fillPosWithPoint(e)}};actions.prototype.onup=function(){if(core.isset(core.status.replay)&&core.status.replay.replaying&&core.status.event.id!="save"&&(core.status.event.id||"").indexOf("book")!=0&&core.status.event.id!="viewMaps"){return}clearTimeout(core.timeout.onDownTimeout);core.timeout.onDownTimeout=null;clearInterval(core.interval.onDownInterval);core.interval.onDownInterval=null;if(core.status.stepPostfix.length>0){var g=[];var a={"0":{"1":"down","-1":"up"},"-1":{"0":"left"},"1":{"0":"right"}};for(var b=1;b<core.status.stepPostfix.length;b++){var d=core.status.stepPostfix[b-1];var c=core.status.stepPostfix[b];g.push({direction:a[c.x-d.x][c.y-d.y],x:c.x+parseInt(core.bigmap.offsetX/32),y:c.y+parseInt(core.bigmap.offsetY/32)})}var e=core.status.stepPostfix[0].x;var f=core.status.stepPostfix[0].y;core.status.stepPostfix=[];if(!core.status.lockControl){core.clearMap("route");core.canvas.route.restore()}if(!core.status.lockControl&&g.length==0&&core.status.downTime!=null&&new Date()-core.status.downTime>=1000){this.longClick(e,f)}else{this.onclick(e,f,g)}core.status.downTime=null}};actions.prototype.getClickLoc=function(f,g){var d={x:0,y:0};var c=32;c=c*core.domStyle.scale;switch(core.domStyle.screenMode){case"vertical":d.x=0;d.y=core.dom.statusBar.offsetHeight+3;break;case"horizontal":case"bigScreen":d.x=core.dom.statusBar.offsetWidth+3;d.y=0;break}var a=core.dom.gameGroup.offsetLeft+d.x;var e=core.dom.gameGroup.offsetTop+d.y;var b={x:f-a,y:g-e,size:c};return b};actions.prototype.onclick=function(b,c,a){if(core.isset(core.status.replay)&&core.status.replay.replaying&&core.status.event.id!="save"&&(core.status.event.id||"").indexOf("book")!=0&&core.status.event.id!="viewMaps"){return}a=a||[];if(b<0||c<0||b>12||c>12){return}if(!core.status.lockControl){core.setAutomaticRoute(b+parseInt(core.bigmap.offsetX/32),c+parseInt(core.bigmap.offsetY/32),a);return}if(core.status.event.id=="centerFly"){this.clickCenterFly(b,c);return}if(core.status.event.id=="book"){this.clickBook(b,c);return}if(core.status.event.id=="book-detail"){this.clickBookDetail(b,c);return}if(core.status.event.id=="fly"){this.clickFly(b,c);return}if(core.status.event.id=="viewMaps"){this.clickViewMaps(b,c);return}if(core.status.event.id=="switchs"){this.clickSwitchs(b,c);return}if(core.status.event.id=="settings"){this.clickSettings(b,c);return}if(core.status.event.id=="shop"){this.clickShop(b,c);return}if(core.status.event.id=="selectShop"){this.clickQuickShop(b,c);return}if(core.status.event.id=="equipbox"){this.clickEquipbox(b,c);return}if(core.status.event.id=="toolbox"){this.clickToolbox(b,c);return}if(core.status.event.id=="save"||core.status.event.id=="load"||core.status.event.id=="replayLoad"){this.clickSL(b,c);return}if(core.status.event.id=="confirmBox"){this.clickConfirmBox(b,c);return}if(core.status.event.id=="keyBoard"){this.clickKeyBoard(b,c);return}if(core.status.event.id=="about"){this.clickAbout(b,c);return}if(core.status.event.id=="action"){this.clickAction(b,c);return}if(core.status.event.id=="text"){core.drawText();return}if(core.status.event.id=="syncSave"){this.clickSyncSave(b,c);return}if(core.status.event.id=="syncSelect"){this.clickSyncSelect(b,c);return}if(core.status.event.id=="localSaveSelect"){this.clickLocalSaveSelect(b,c);return}if(core.status.event.id=="storageRemove"){this.clickStorageRemove(b,c);return}if(core.status.event.id=="cursor"){this.clickCursor(b,c);return}if(core.status.event.id=="replay"){this.clickReplay(b,c);return}};actions.prototype.onmousewheel=function(a){if(core.isset(core.status.replay)&&core.status.replay.replaying&&core.status.event.id!="save"&&(core.status.event.id||"").indexOf("book")!=0&&core.status.event.id!="viewMaps"){if(a==1){core.speedUpReplay()}if(a==-1){core.speedDownReplay()}return}if(core.status.lockControl&&core.status.event.id=="fly"){if(a==1){core.ui.drawFly(core.status.event.data+1)}if(a==-1){core.ui.drawFly(core.status.event.data-1)}return}if(core.status.lockControl&&core.status.event.id=="book"){if(a==1){core.ui.drawBook(core.status.event.data-6)}if(a==-1){core.ui.drawBook(core.status.event.data+6)}return}if(core.status.lockControl&&(core.status.event.id=="save"||core.status.event.id=="load")){if(a==1){core.ui.drawSLPanel(core.status.event.data-10)}if(a==-1){core.ui.drawSLPanel(core.status.event.data+10)}return}if(core.status.lockControl&&core.status.event.id=="viewMaps"){if(a==1){this.clickViewMaps(6,3)}if(a==-1){this.clickViewMaps(6,9)}return}};actions.prototype.longClick=function(b,c,a){if(!core.isPlaying()){return false}if(core.status.lockControl){if(core.status.event.id=="text"){core.drawText();return true}if(core.status.event.id=="action"&&core.status.event.data.type=="text"){core.doAction();return true}}else{if(!a){core.waitHeroToStop(function(){core.ui.drawKeyBoard()})}}return false};actions.prototype.keyDownCtrl=function(){if(core.status.event.id=="text"){core.drawText();return}if(core.status.event.id=="action"&&core.status.event.data.type=="text"){core.doAction();return}};actions.prototype.clickCenterFly=function(a,b){if(a==core.status.event.data.poxX&&b==core.status.event.data.posY){if(core.canUseItem("centerFly")){core.useItem("centerFly")}else{core.drawTip("当前不能使用中心对称飞行器")}}core.ui.closePanel()};actions.prototype.keyUpCenterFly=function(a){if(a==51||a==13||a==32||a==67){if(core.canUseItem("centerFly")){core.useItem("centerFly")}else{core.drawTip("当前不能使用中心对称飞行器")}}core.ui.closePanel()};actions.prototype.clickConfirmBox=function(a,b){if((a==4||a==5)&&b==7&&core.isset(core.status.event.data.yes)){core.status.event.data.yes()}if((a==7||a==8)&&b==7&&core.isset(core.status.event.data.no)){core.status.event.data.no()}};actions.prototype.keyUpConfirmBox=function(a){if(a==37){core.status.event.selection=0;core.ui.drawConfirmBox(core.status.event.ui,core.status.event.data.yes,core.status.event.data.no)}if(a==39){core.status.event.selection=1;core.ui.drawConfirmBox(core.status.event.ui,core.status.event.data.yes,core.status.event.data.no)}if(a==13||a==32||a==67){if(core.status.event.selection==0&&core.isset(core.status.event.data.yes)){core.status.event.selection=null;core.status.event.data.yes()}if(core.status.event.selection==1&&core.isset(core.status.event.data.no)){core.status.event.selection=null;core.status.event.data.no()}}};actions.prototype.clickAction=function(d,e){if(core.status.event.data.type=="text"){if(core.status.event.interval!=null){core.insertAction({type:"text",text:core.status.event.ui,showAll:true})}core.doAction();return}if(core.status.event.data.type=="wait"){core.setFlag("type",1);core.setFlag("x",d);core.setFlag("y",e);core.status.route.push("input:"+(10000+100*d+e));core.doAction();return}if(core.status.event.data.type=="choices"){var b=core.status.event.data.current;var a=b.choices;if(a.length==0){return}if(d>=5&&d<=7){var c=6-parseInt((a.length-1)/2);if(e>=c&&e<c+a.length){core.status.route.push("choices:"+(e-c));core.insertAction(a[e-c].action);core.doAction()}}}};actions.prototype.keyDownAction=function(c){if(core.status.event.data.type=="choices"){var b=core.status.event.data.current;var a=b.choices;if(a.length>0){if(c==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(c==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}}}};actions.prototype.keyUpAction=function(c){if(core.status.event.data.type=="text"&&(c==13||c==32||c==67)){if(core.status.event.interval!=null){core.insertAction({type:"text",text:core.status.event.ui,showAll:true})}core.doAction();return}if(core.status.event.data.type=="wait"){core.setFlag("type",0);core.setFlag("keycode",c);core.status.route.push("input:"+c);core.doAction();return}if(core.status.event.data.type=="choices"){var b=core.status.event.data.current;var a=b.choices;if(a.length>0){if(c==13||c==32||c==67){core.status.route.push("choices:"+core.status.event.selection);core.insertAction(a[core.status.event.selection].action);core.doAction()}}}};actions.prototype.clickBook=function(d,e){if((d==3||d==4)&&e==12){core.ui.drawBook(core.status.event.data-6);return}if((d==8||d==9)&&e==12){core.ui.drawBook(core.status.event.data+6);return}if(d>=10&&d<=12&&e==12){if(core.status.event.selection==null){core.ui.closePanel()}else{core.status.boxAnimateObjs=[];core.ui.drawMaps(core.status.event.selection)}return}var a=core.status.event.data;if(core.isset(a)&&e<12){var c=parseInt(a/6);var b=6*c+parseInt(e/2);core.ui.drawBook(b);core.ui.drawBookDetail(b)}return};actions.prototype.keyDownBook=function(a){if(a==37){core.ui.drawBook(core.status.event.data-6)}if(a==38){core.ui.drawBook(core.status.event.data-1)}if(a==39){core.ui.drawBook(core.status.event.data+6)}if(a==40){core.ui.drawBook(core.status.event.data+1)}if(a==33){core.ui.drawBook(core.status.event.data-6)}if(a==34){core.ui.drawBook(core.status.event.data+6)}return};actions.prototype.keyUpBook=function(b){if(b==27||b==88){if(core.status.event.selection==null){core.ui.closePanel()}else{core.status.boxAnimateObjs=[];core.ui.drawMaps(core.status.event.selection)}return}if(b==13||b==32||b==67){var a=core.status.event.data;if(core.isset(a)){this.clickBook(6,2*(a%6))}return}};actions.prototype.clickBookDetail=function(){core.clearMap("data");core.status.event.id="book"};actions.prototype.clickFly=function(a,b){if((a==10||a==11)&&b==9){core.ui.drawFly(core.status.event.data-1)}if((a==10||a==11)&&b==5){core.ui.drawFly(core.status.event.data+1)}if((a==10||a==11)&&b==10){core.ui.drawFly(core.status.event.data-10)}if((a==10||a==11)&&b==4){core.ui.drawFly(core.status.event.data+10)}if(a>=5&&a<=7&&b==12){core.ui.closePanel()}if(a>=0&&a<=9&&b>=3&&b<=11){core.control.flyTo(core.status.hero.flyRange[core.status.event.data])}return};actions.prototype.keyDownFly=function(a){if(a==37){core.ui.drawFly(core.status.event.data-10)}else{if(a==38){core.ui.drawFly(core.status.event.data+1)}else{if(a==39){core.ui.drawFly(core.status.event.data+10)}else{if(a==40){core.ui.drawFly(core.status.event.data-1)}}}}return};actions.prototype.keyUpFly=function(a){if(a==71||a==27||a==88){core.ui.closePanel()}if(a==13||a==32||a==67){this.clickFly(5,5)}return};actions.prototype.clickViewMaps=function(h,i){if(!core.isset(core.status.event.data)){core.ui.drawMaps(core.floorIds.indexOf(core.status.floorId));return}var g=core.floorIds.indexOf(core.status.floorId);var d=core.status.event.data.index;var a=core.status.event.data.x,b=core.status.event.data.y;var c=core.floorIds[d],f=core.floors[c].width||13,e=core.floors[c].height||13;if(h==0&&i==0){core.status.event.data.damage=!core.status.event.data.damage;core.ui.drawMaps(d,a,b);return}if(h>=2&&h<=10&&i<=1&&e>13){core.ui.drawMaps(d,a,b-1);return}if(h>=2&&h<=10&&i>=11&&e>13){core.ui.drawMaps(d,a,b+1);return}if(h<=1&&i>=2&&i<=10){core.ui.drawMaps(d,a-1,b);return}if(h>=11&&i>=2&&i<=10){core.ui.drawMaps(d,a+1,b);return}if(i<=4&&(e==13||(h>=2&&h<=10))){d++;while(d<core.floorIds.length&&d!=g&&core.status.maps[core.floorIds[d]].cannotViewMap){d++}if(d<core.floorIds.length){core.ui.drawMaps(d)}}else{if(i>=8&&(e==13||(h>=2&&h<=10))){d--;while(d>=0&&d!=g&&core.status.maps[core.floorIds[d]].cannotViewMap){d--}if(d>=0){core.ui.drawMaps(d)}}else{if(h>=2&&h<=10&&i>=5&&i<=7){core.clearMap("data");core.setOpacity("data",1);core.ui.closePanel()}}}};actions.prototype.keyDownViewMaps=function(b){if(!core.isset(core.status.event.data)){return}var a=core.floorIds[core.status.event.data.index],c=core.floors[a].height||13;if(b==38||b==33){this.clickViewMaps(6,3)}if(b==40||b==34){this.clickViewMaps(6,9)}if(b==87&&c>13){this.clickViewMaps(6,0)}if(b==65){this.clickViewMaps(0,6)}if(b==83&&c>13){this.clickViewMaps(6,12)}if(b==68){this.clickViewMaps(12,6)}return};actions.prototype.keyUpViewMaps=function(a){if(!core.isset(core.status.event.data)){core.ui.drawMaps(core.floorIds.indexOf(core.status.floorId));return}if(a==27||a==13||a==32||(!core.status.replay.replaying&&a==67)){core.clearMap("data");core.setOpacity("data",1);core.ui.closePanel()}if(a==86){core.status.event.data.damage=!core.status.event.data.damage;core.ui.drawMaps(core.status.event.data.index,core.status.event.data.x,core.status.event.data.y)}if(a==88||(core.status.replay.replaying&&a==67)){if(core.isset(core.status.replay)&&core.status.replay.replaying){core.bookReplay()}else{core.openBook(false)}}return};actions.prototype.clickShop=function(x,y){var shop=core.status.event.data.shop;var choices=shop.choices;if(x>=5&&x<=7){var topIndex=6-parseInt(choices.length/2);if(y>=topIndex&&y<topIndex+choices.length){core.status.event.selection=y-topIndex;var money=core.getStatus("money"),experience=core.getStatus("experience");var times=shop.times,need=eval(shop.need);var use=shop.use;var use_text=use=="money"?"金币":"经验";var choice=choices[y-topIndex];if(core.isset(choice.need)){need=eval(choice.need)}if(need>eval(use)){core.drawTip("你的"+use_text+"不足");return false}core.status.event.data.actions.push(y-topIndex);eval(use+"-="+need);core.setStatus("money",money);core.setStatus("experience",experience);choice.effect.split(";").forEach(function(t){core.doEffect(t)});core.updateStatusBar();shop.times++;core.events.openShop(core.status.event.data.id)}else{if(y==topIndex+choices.length){if(core.status.event.data.actions.length>0){core.status.route.push("shop:"+core.status.event.data.id+":"+core.status.event.data.actions.join(""))}core.status.event.data.actions=[];core.status.boxAnimateObjs=[];if(core.status.event.data.fromList){core.ui.drawQuickShop()}else{core.ui.closePanel()}}else{return false}}}return true};actions.prototype.keyDownShop=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};actions.prototype.keyUpShop=function(b){if(b==27||b==88){if(core.status.event.data.actions.length>0){core.status.route.push("shop:"+core.status.event.data.id+":"+core.status.event.data.actions.join(""))}core.status.event.data.actions=[];core.status.boxAnimateObjs=[];if(core.status.event.data.fromList){core.ui.drawQuickShop()}else{core.ui.closePanel()}return}var c=core.status.event.data.shop;var a=c.choices;if(b==13||b==32||b==67){var d=6-parseInt(a.length/2);this.clickShop(6,d+core.status.event.selection)}return};actions.prototype.clickQuickShop=function(e,f){var c=core.status.shops,a=Object.keys(c);if(e>=5&&e<=7){var d=6-parseInt(a.length/2);if(f>=d&&f<d+a.length){var b=core.events.canUseQuickShop(a[f-d]);if(core.isset(b)){core.drawText(b);return}core.events.openShop(a[f-d],true);if(core.status.event.id=="shop"){core.status.event.data.fromList=true}}else{if(f==d+a.length){core.ui.closePanel()}}}};actions.prototype.keyDownQuickShop=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};actions.prototype.keyUpQuickShop=function(a){if(a==27||a==75||a==88||a==86){core.ui.closePanel();return}var c=core.status.shops,b=Object.keys(c);if(a==13||a==32||a==67){var d=6-parseInt(b.length/2);this.clickQuickShop(6,d+core.status.event.selection)}return};actions.prototype.clickToolbox=function(d,e){if(d>=10&&d<=12&&e==0){core.ui.closePanel();core.openEquipbox();return}if(d>=10&&d<=12&&e==12){core.ui.closePanel();return}var c=core.status.event.data.toolsPage;var a=core.status.event.data.constantsPage;if(d==3||d==4){if(e==7&&c>1){core.status.event.data.toolsPage--;core.ui.drawToolbox(core.status.event.selection)}if(e==12&&a>1){core.status.event.data.toolsPage--;core.ui.drawToolbox(core.status.event.selection)}}if(d==8||d==9){if(e==7&&c<Math.ceil(Object.keys(core.status.hero.items.tools).length/12)){core.status.event.data.toolsPage++;core.ui.drawToolbox(core.status.event.selection)}if(e==12&&a<Math.ceil(Object.keys(core.status.hero.items.constants).length/12)){core.status.event.data.constantsPage++;core.ui.drawToolbox(core.status.event.selection)}}var b=parseInt(d/2);if(e==4){b+=0}else{if(e==6){b+=6}else{if(e==9){b+=12}else{if(e==11){b+=18}else{b=-1}}}}if(b>=0){this.clickToolboxIndex(b)}};actions.prototype.clickToolboxIndex=function(a){var c=null;var d;if(a<12){d=a+12*(core.status.event.data.toolsPage-1);c=Object.keys(core.status.hero.items.tools).sort()}else{d=a%12+12*(core.status.event.data.constantsPage-1);c=Object.keys(core.status.hero.items.constants).sort()}if(c==null){return}if(d>=c.length){return}var b=c[d];if(b==core.status.event.data.selectId){core.events.useItem(b)}else{core.ui.drawToolbox(a)}};actions.prototype.keyDownToolbox=function(f){if(!core.isset(core.status.event.data)){return}var h=Object.keys(core.status.hero.items.tools).sort();var a=Object.keys(core.status.hero.items.constants).sort();var e=core.status.event.selection;var j=core.status.event.data.toolsPage;var c=core.status.event.data.constantsPage;var k=Math.ceil(h.length/12);var d=Math.ceil(a.length/12);var i=j<k?11:(h.length+11)%12;var b=12+(c<d?11:(a.length+11)%12);if(f==37){if(e==0){if(j>1){core.status.event.data.toolsPage--;e=11}else{return}}else{if(e==12){if(c==1){if(k==0){return}core.status.event.data.toolsPage=k;e=(h.length+11)%12}else{core.status.event.data.constantsPage--;e=23}}else{e-=1}}this.clickToolboxIndex(e);return}if(f==38){if(e>=12&&e<=17){if(k==0){return}if(i>=6){e=Math.min(i,e-6)}else{e=Math.min(i,e-12)}}else{if(e<6){return}else{e-=6}}this.clickToolboxIndex(e);return}if(f==39){if(j<k&&e==11){core.status.event.data.toolsPage++;e=0}else{if(c<d&&e==23){core.status.event.data.constantsPage++;e=12}else{if(e==i){if(d==0){return}core.status.event.data.constantsPage=1;e=12}else{if(e==b){return}else{e++}}}}this.clickToolboxIndex(e);return}if(f==40){var g=null;if(e<=5){if(i>5){g=Math.min(i,e+6)}else{e+=6}}if(g==null&&e<=11){if(d==0){return}g=Math.min(e+6,b)}if(g==null&&e<=17){if(b>17){g=Math.min(b,e+6)}}if(g!=null){this.clickToolboxIndex(g)}return}};actions.prototype.keyUpToolbox=function(a){if(a==81){core.ui.closePanel();core.openEquipbox();return}if(a==84||a==27||a==88){core.ui.closePanel();return}if(!core.isset(core.status.event.data)){return}if(a==13||a==32||a==67){this.clickToolboxIndex(core.status.event.selection);return}};actions.prototype.clickEquipbox=function(d,e){if(d>=10&&d<=12&&e==0){core.ui.closePanel();core.openToolbox();return}if(d>=10&&d<=12&&e==12){core.ui.closePanel();return}var c=core.status.event.data.page;if((d==3||d==4)&&e==12){if(c>1){core.status.event.data.page--;core.ui.drawEquipbox(core.status.event.selection)}return}if((d==8||d==9)&&e==12){var b=Math.ceil(Object.keys(core.status.hero.items.equips).length/12);if(c<b){core.status.event.data.page++;core.ui.drawEquipbox(core.status.event.selection)}return}var a=parseInt(d/2);if(e==4){a+=0}else{if(e==6){a+=6}else{if(e==9){a+=12}else{if(e==11){a+=18}else{a=-1}}}}if(a>=0){if(a<12){a=parseInt(a/2)}this.clickEquipboxIndex(a)}};actions.prototype.clickEquipboxIndex=function(c){if(c<6){if(c>=(main.equipName||[]).length){return}if(c==core.status.event.selection&&core.isset(core.status.hero.equipment[c])){core.unloadEquip(c);core.status.route.push("unEquip:"+c)}}else{if(c>=12){var b=Object.keys(core.status.hero.items.equips||{}).sort();if(c==core.status.event.selection){var a=b[c-12+(core.status.event.data.page-1)*12];core.loadEquip(a);core.status.route.push("equip:"+a)}}}core.ui.drawEquipbox(c)};actions.prototype.keyDownEquipbox=function(c){if(!core.isset(core.status.event.data)){return}var a=(main.equipName||[]).length;var d=Object.keys(core.status.hero.items.equips).sort();var b=core.status.event.selection;var e=core.status.event.data.page;var g=Math.ceil(d.length/12);var f=12+(e<g?11:(d.length+11)%12);if(c==37){if(b==0){return}if(b==12){if(e>1){core.status.event.data.page--;b=23}else{if(e==1){b=a-1}else{return}}}else{b-=1}this.clickEquipboxIndex(b);return}if(c==38){if(b<3){return}else{if(b<6){b-=3}else{if(b<18){b=parseInt((b-12)/2);if(a>3){b=Math.min(a-1,b+3)}else{b=Math.min(a-1,b)}}else{b-=6}}}this.clickEquipboxIndex(b);return}if(c==39){if(e<g&&b==23){core.status.event.data.page++;b=12}else{if(b==a-1){if(g==0){return}b=12}else{if(b==f){return}else{b++}}}this.clickEquipboxIndex(b);return}if(c==40){if(b<3){if(a>3){b=Math.min(b+3,a-1)}else{if(g==0){return}b=Math.min(2*b+1+12,f)}}else{if(b<6){if(g==0){return}b=Math.min(2*(b-3)+1+12,f)}else{if(b<18){b=Math.min(b+6,f)}else{return}}}this.clickEquipboxIndex(b);return}};actions.prototype.keyUpEquipbox=function(a){if(a==84){core.ui.closePanel();core.openToolbox();return}if(a==81||a==27||a==88){core.ui.closePanel();return}if(!core.isset(core.status.event.data.selectId)){return}if(a==13||a==32||a==67){this.clickEquipboxIndex(core.status.event.selection);return}};actions.prototype.clickSL=function(e,f){var b=core.status.event.data;var d=parseInt(b/10),c=b%10;if((e==3||e==4)&&f==12){core.ui.drawSLPanel(10*(d-1)+c);return}if((e==8||e==9)&&f==12){core.ui.drawSLPanel(10*(d+1)+c);return}if(e>=10&&e<=12&&f==12){core.ui.closePanel();if(!core.isPlaying()){core.showStartAnimate()}return}if(e>=0&&e<=2&&f==12){if(core.status.event.id=="save"){core.status.event.selection=!core.status.event.selection;core.ui.drawSLPanel(b)}else{var b=parseInt(prompt("请输入读档编号"))||0;if(b>0){core.doSL(b,core.status.event.id)}}return}var a=null;if(f>=1&&f<=4){if(e>=1&&e<=3){a="autoSave"}if(e>=5&&e<=7){a=5*d+1}if(e>=9&&e<=11){a=5*d+2}}if(f>=7&&f<=10){if(e>=1&&e<=3){a=5*d+3}if(e>=5&&e<=7){a=5*d+4}if(e>=9&&e<=11){a=5*d+5}}if(a!=null){if(core.status.event.selection){if(a=="autoSave"){core.drawTip("无法删除自动存档！")}else{core.removeLocalForage("save"+a,function(){core.ui.drawSLPanel(b,true)},function(){core.drawTip("无法删除存档！")})}}else{core.doSL(a,core.status.event.id)}}};actions.prototype.keyDownSL=function(b){var a=core.status.event.data;var d=parseInt(a/10),c=a%10;if(b==37){if(c==0){core.ui.drawSLPanel(10*(d-1)+5)}else{core.ui.drawSLPanel(a-1)}return}if(b==38){if(c<3){core.ui.drawSLPanel(10*(d-1)+c+3)}else{core.ui.drawSLPanel(a-3)}return}if(b==39){if(c==5){core.ui.drawSLPanel(10*(d+1)+1)}else{core.ui.drawSLPanel(a+1)}return}if(b==40){if(c>=3){core.ui.drawSLPanel(10*(d+1)+c-3)}else{core.ui.drawSLPanel(a+3)}return}if(b==33){core.ui.drawSLPanel(10*(d-1)+c);return}if(b==34){core.ui.drawSLPanel(10*(d+1)+c);return}};actions.prototype.keyUpSL=function(b){var a=core.status.event.data;var d=parseInt(a/10),c=a%10;if(b==27||b==88||(core.status.event.id=="save"&&b==83)||(core.status.event.id=="load"&&b==68)){core.ui.closePanel();if(!core.isPlaying()){core.showStartAnimate()}return}if(b==13||b==32||b==67){if(c==0){core.doSL("autoSave",core.status.event.id)}else{core.doSL(5*d+c,core.status.event.id)}return}if(b==69&&core.status.event.id=="load"){var a=parseInt(prompt("请输入读档编号"))||0;if(a>0){core.doSL(a,core.status.event.id)}return}if(b==46){if(c==0){core.drawTip("无法删除自动存档！")}else{core.removeLocalForage("save"+(5*d+c),function(){core.ui.drawSLPanel(a,true)},function(){core.drawTip("无法删除存档！")})}}};actions.prototype.clickSwitchs=function(d,e){if(d<5||d>7){return}var a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(e>=c&&e<c+a.length){var b=e-c;switch(b){case 0:core.musicStatus.bgmStatus=!core.musicStatus.bgmStatus;if(core.musicStatus.bgmStatus){core.resumeBgm()}else{core.pauseBgm();core.musicStatus.playingBgm=null}core.setLocalStorage("bgmStatus",core.musicStatus.bgmStatus);core.ui.drawSwitchs();break;case 1:core.musicStatus.soundStatus=!core.musicStatus.soundStatus;core.setLocalStorage("soundStatus",core.musicStatus.soundStatus);core.ui.drawSwitchs();break;case 2:if(!core.flags.canOpenBattleAnimate){core.drawTip("本塔不能开启战斗动画！")}else{core.flags.battleAnimate=!core.flags.battleAnimate;core.setLocalStorage("battleAnimate",core.flags.battleAnimate);core.ui.drawSwitchs()}break;case 3:core.flags.displayEnemyDamage=!core.flags.displayEnemyDamage;core.updateDamage();core.setLocalStorage("enemyDamage",core.flags.displayEnemyDamage);core.ui.drawSwitchs();break;case 4:core.flags.displayCritical=!core.flags.displayCritical;core.updateDamage();core.setLocalStorage("critical",core.flags.displayCritical);core.ui.drawSwitchs();break;case 5:core.flags.displayExtraDamage=!core.flags.displayExtraDamage;core.updateDamage();core.setLocalStorage("extraDamage",core.flags.displayExtraDamage);core.ui.drawSwitchs();break;case 6:core.flags.clickMoveDirectly=!core.flags.clickMoveDirectly;core.setLocalStorage("clickMoveDirectly",core.flags.clickMoveDirectly);core.ui.drawSwitchs();break;case 7:core.platform.useLocalForage=!core.platform.useLocalForage;core.setLocalStorage("useLocalForage",core.platform.useLocalForage);core.ui.drawSwitchs();break;case 8:window.open(core.platform.isPC?"editor.html":"editor-mobile.html","_blank");break;case 9:window.open(core.firstData.name+".zip","_blank");break;case 10:core.status.event.selection=0;core.ui.drawSettings();break}}};actions.prototype.keyDownSwitchs=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};actions.prototype.keyUpSwitchs=function(b){if(b==27||b==88){core.status.event.selection=0;core.ui.drawSettings();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickSwitchs(6,c+core.status.event.selection)}};actions.prototype.clickSettings=function(d,e){if(d<5||d>7){return}var a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(e>=c&&e<c+a.length){var b=e-c;switch(b){case 0:core.status.event.selection=0;core.ui.drawSwitchs();break;case 1:core.status.event.selection=0;core.ui.drawQuickShop();break;case 2:if(!core.flags.enableViewMaps){core.drawTip("本塔不允许浏览地图！")}else{core.ui.drawMaps()}break;case 3:core.status.event.selection=0;core.ui.drawSyncSave();break;case 4:core.status.event.selection=1;core.ui.drawConfirmBox("你确定要返回标题页面吗？",function(){core.ui.closePanel();core.restart()},function(){core.status.event.selection=3;core.ui.drawSettings()});break;case 5:core.ui.drawStatistics();break;case 6:core.ui.drawHelp();break;case 7:core.ui.drawAbout();break;case 8:core.ui.closePanel();break}}return};actions.prototype.keyDownSettings=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};actions.prototype.keyUpSettings=function(b){if(b==27||b==88){core.ui.closePanel();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickSettings(6,c+core.status.event.selection)}};actions.prototype.clickSyncSave=function(d,e){if(d<5||d>7){return}var a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(e>=c&&e<c+a.length){var b=e-c;switch(b){case 0:core.status.event.selection=0;core.ui.drawSyncSelect();break;case 1:core.syncLoad();break;case 2:core.status.event.selection=0;core.ui.drawLocalSaveSelect();break;case 3:core.readFile(function(g){if(g.name!=core.firstData.name){alert("存档和游戏不一致！");return}if(g.version!=core.firstData.version){alert("游戏版本不一致！");return}if(!core.isset(g.data)){alert("无效的存档！");return}var f=g.data;if(f instanceof Array){core.ui.drawConfirmBox("所有本地存档都将被覆盖，确认？",function(){for(var h=1;h<=5*(main.savePages||30);h++){if(h<=f.length){core.setLocalForage("save"+h,f[h-1])}else{core.removeLocalForage("save"+h)}}core.drawText("读取成功！\n你的本地所有存档均已被覆盖。")},function(){core.status.event.selection=0;core.ui.drawSyncSave()})}else{core.setLocalForage("save"+core.status.saveIndex,f,function(){core.drawText("同步成功！\n单存档已覆盖至存档"+core.status.saveIndex)})}},function(){});break;case 4:core.status.event.selection=0;core.ui.drawReplay();break;case 5:if(core.hasFlag("debug")){core.drawText("\t[系统提示]调试模式下无法下载录像");break}core.download(core.firstData.name+"_"+core.formatDate2(new Date())+".h5route",JSON.stringify({name:core.firstData.name,hard:core.status.hard,seed:core.getFlag("seed"),route:core.encodeRoute(core.status.route)}));break;case 6:core.status.event.selection=0;core.ui.drawStorageRemove();break;case 7:core.status.event.selection=3;core.ui.drawSettings();break}}return};actions.prototype.keyDownSyncSave=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};actions.prototype.keyUpSyncSave=function(b){if(b==27||b==88){core.status.event.selection=2;core.ui.drawSettings();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickSyncSave(6,c+core.status.event.selection)}};actions.prototype.clickSyncSelect=function(d,e){if(d<5||d>7){return}var a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(e>=c&&e<c+a.length){var b=e-c;switch(b){case 0:core.syncSave("all");break;case 1:core.syncSave();break;case 2:core.status.event.selection=0;core.ui.drawSyncSave();break}}};actions.prototype.keyDownSyncSelect=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};actions.prototype.keyUpSyncSelect=function(b){if(b==27||b==88){core.status.event.selection=0;core.ui.drawSettings();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickSyncSelect(6,c+core.status.event.selection)}};actions.prototype.clickLocalSaveSelect=function(e,f){if(e<5||e>7){return}var a=core.status.event.ui.choices;var d=6-parseInt((a.length-1)/2);var b=null;if(f>=d&&f<d+a.length){var c=f-d;if(c<2){core.control.getSaves(c==0?null:core.status.saveIndex,function(h){if(core.isset(h)){var g={name:core.firstData.name,version:core.firstData.version,data:h};core.download(core.firstData.name+"_"+core.formatDate2(new Date())+".h5save",JSON.stringify(g))}})}}core.status.event.selection=2;core.ui.drawSyncSave()};actions.prototype.keyDownLocalSaveSelect=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};actions.prototype.keyUpLocalSaveSelect=function(b){if(b==27||b==88){core.status.event.selection=0;core.ui.drawSettings();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickLocalSaveSelect(6,c+core.status.event.selection)}};actions.prototype.clickStorageRemove=function(e,f){if(e<5||e>7){return}var a=core.status.event.ui.choices;var d=6-parseInt((a.length-1)/2);if(f>=d&&f<d+a.length){var c=f-d;switch(c){case 0:if(core.platform.useLocalForage){core.ui.drawWaiting("正在清空，请稍后...");localforage.clear(function(){core.ui.closePanel();core.drawText("\t[操作成功]你的所有存档已被清空。")})}else{localStorage.clear();core.drawText("\t[操作成功]你的所有存档已被清空。")}break;case 1:if(core.platform.useLocalForage){core.ui.drawWaiting("正在清空，请稍后...");for(var b=1;b<=5*(main.savePages||30);b++){core.removeLocalForage("save"+b)}core.removeLocalForage("autoSave",function(){core.ui.closePanel();core.drawText("\t[操作成功]当前塔的存档已被清空。")})}else{for(var b=1;b<=5*(main.savePages||30);b++){core.removeLocalStorage("save"+b)}core.removeLocalStorage("autoSave");core.drawText("\t[操作成功]当前塔的存档已被清空。")}break;case 2:core.status.event.selection=5;core.ui.drawSyncSave();break}}};actions.prototype.keyDownStorageRemove=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};actions.prototype.keyUpStorageRemove=function(b){if(b==27||b==88){core.status.event.selection=5;core.ui.drawSyncSave();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickStorageRemove(6,c+core.status.event.selection)}};actions.prototype.clickReplay=function(j,k){if(j<5||j>7){return}var a=core.status.event.ui.choices;var i=6-parseInt((a.length-1)/2);if(k>=i&&k<i+a.length){var h=k-i;switch(h){case 0:core.ui.closePanel();var b=core.status.hard,e=core.clone(core.status.route);var g=core.getFlag("seed");core.resetStatus(core.firstData.hero,b,core.firstData.floorId,null,core.initStatus.maps);core.events.setInitData(b);core.setFlag("seed",g);core.setFlag("rand",g);core.changeFloor(core.status.floorId,null,core.firstData.hero.loc,null,function(){core.startReplay(e)},true);break;case 1:core.status.event.id="replayLoad";core.status.event.selection=null;var f=core.status.saveIndex;var d=parseInt((f-1)/5),c=f-5*d;core.ui.drawSLPanel(10*d+c);break;case 2:if(core.hasFlag("debug")){core.drawText("\t[系统提示]调试模式下无法下载录像");break}core.download(core.firstData.name+"_"+core.formatDate2(new Date())+".h5route",JSON.stringify({name:core.firstData.name,hard:core.status.hard,seed:core.getFlag("seed"),route:core.encodeRoute(core.status.route)}));break;break;case 3:core.ui.closePanel();break}}};actions.prototype.keyDownReplay=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};actions.prototype.keyUpReplay=function(b){if(b==27||b==88){core.ui.closePanel();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickReplay(6,c+core.status.event.selection)}};actions.prototype.clickKeyBoard=function(b,c){if(c==3&&b>=1&&b<=11){core.ui.closePanel();core.keyUp(112+b-1)}if(c==4&&b>=1&&b<=10){core.ui.closePanel();core.keyUp(b==10?48:48+b)}var a=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["Z","X","C","V","B","N","M"],];if(c==5&&b>=1&&b<=10){core.ui.closePanel();core.keyUp(a[0][b-1].charCodeAt(0))}if(c==6&&b>=1&&b<=9){core.ui.closePanel();core.keyUp(a[1][b-1].charCodeAt(0))}if(c==7&&b>=1&&b<=7){core.ui.closePanel();core.keyUp(a[2][b-1].charCodeAt(0))}if(c==8&&b>=1&&b<=11){core.ui.closePanel();if(b==1){core.keyUp(189)}if(b==2){core.keyUp(187)}if(b==3){core.keyUp(219)}if(b==4){core.keyUp(221)}if(b==5){core.keyUp(220)}if(b==6){core.keyUp(186)}if(b==7){core.keyUp(222)}if(b==8){core.keyUp(188)}if(b==9){core.keyUp(190)}if(b==10){core.keyUp(191)}if(b==11){core.keyUp(192)}}if(c==9&&b>=1&&b<=10){core.ui.closePanel();if(b==1){core.keyUp(27)}if(b==2){core.keyUp(9)}if(b==3){core.keyUp(20)}if(b==4){core.keyUp(16)}if(b==5){core.keyUp(17)}if(b==6){core.keyUp(18)}if(b==7){core.keyUp(32)}if(b==8){core.keyUp(8)}if(b==9){core.keyUp(13)}if(b==10){core.keyUp(46)}}if(c==10&&b>=9&&b<=11){core.ui.closePanel()}};actions.prototype.clickCursor=function(a,b){if(a==core.status.automaticRoute.cursorX&&b==core.status.automaticRoute.cursorY){core.ui.closePanel();core.onclick(a,b,[]);return}core.status.automaticRoute.cursorX=a;core.status.automaticRoute.cursorY=b;core.ui.drawCursor()};actions.prototype.keyDownCursor=function(a){if(a==37){core.status.automaticRoute.cursorX--;core.ui.drawCursor();return}if(a==38){core.status.automaticRoute.cursorY--;core.ui.drawCursor();return}if(a==39){core.status.automaticRoute.cursorX++;core.ui.drawCursor();return}if(a==40){core.status.automaticRoute.cursorY++;core.ui.drawCursor();return}};actions.prototype.keyUpCursor=function(a){if(a==27||a==88){core.ui.closePanel();return}if(a==13||a==32||a==67||a==69){core.ui.closePanel();core.onclick(core.status.automaticRoute.cursorX,core.status.automaticRoute.cursorY,[]);return}};actions.prototype.clickAbout=function(){if(core.isPlaying()){core.ui.closePanel()}else{core.restart()}};