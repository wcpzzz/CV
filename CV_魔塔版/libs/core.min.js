function core(){this.material={animates:{},images:{},bgms:{},sounds:{},ground:null,items:{},enemys:{},icons:{},events:{}};this.timeout={getItemTipTimeout:null,turnHeroTimeout:null,onDownTimeout:null,};this.interval={heroMoveInterval:null,tipAnimate:null,openDoorAnimate:null,animateInterval:null,onDownInterval:null,};this.animateFrame={background:null,globalAnimate:false,globalTime:null,boxTime:null,animateTime:null,moveTime:null,speed:null,weather:{time:null,type:null,level:0,nodes:[],data:null,}};this.musicStatus={audioContext:null,startDirectly:false,bgmStatus:false,soundStatus:true,playingBgm:null,isPlaying:false,gainNode:null,volume:1,};this.platform={isOnline:true,isPC:true,isAndroid:false,isIOS:false,isWeChat:false,isQQ:false,isChrome:false,supportCopy:false,useLocalForage:true,fileInput:null,fileReader:null,successCallback:null,errorCallback:null,};this.domStyle={styles:[],scale:1,};this.bigmap={canvas:["bg","event","event2","fg","damage","route"],offsetX:0,offsetY:0,width:13,height:13,tempCanvas:null,};this.initStatus={played:false,gameOver:false,hero:{},floorId:null,thisMap:null,maps:null,checkBlock:{},lockControl:false,heroMoving:0,heroStop:true,automaticRoute:{autoHeroMove:false,autoStep:0,movedStep:0,destStep:0,destX:null,destY:null,autoStepRoutes:[],moveStepBeforeStop:[],lastDirection:null,cursorX:null,cursorY:null,moveDirectly:false,},downTime:null,ctrlDown:false,route:[],replay:{replaying:false,pausing:false,animate:false,toReplay:[],totalList:[],speed:1,steps:0,save:[],},saveIndex:null,shops:{},event:{id:null,data:null,selection:null,ui:null,interval:null,},textAttribute:{position:"center",title:[255,215,0,1],background:[0,0,0,0.85],text:[255,255,255,1],titlefont:22,textfont:16,bold:false,time:0,},curtainColor:null,openingDoor:null,isSkiing:false,globalAnimateObjs:[],boxAnimateObjs:[],animateObjs:[],};this.status={}}core.prototype.init=function(d,a){for(var g in d){core[g]=d[g]}core.flags=core.clone(core.data.flags);core.values=core.clone(core.data.values);core.firstData=core.data.getFirstData();if(!core.flags.enableExperience){core.flags.enableLevelUp=false}if(!core.flags.canOpenBattleAnimate){core.flags.showBattleAnimateConfirm=false;core.flags.battleAnimate=false;core.setLocalStorage("battleAnimate",false)}if(core.isset(core.firstData.shops)){core.firstData.shops.forEach(function(e){core.initStatus.shops[e.id]=e})}core.dom.versionLabel.innerHTML=core.firstData.version;core.dom.logoLabel.innerHTML=core.firstData.title;document.title=core.firstData.title+" - HTML5魔塔";document.getElementById("startLogo").innerHTML=core.firstData.title;core.material.items=core.clone(core.items.getItems());core.material.enemys=core.clone(core.enemys.getEnemys());core.material.icons=core.icons.getIcons();core.material.events=core.events.getEvents();core.platform.isOnline=location.protocol.indexOf("http")==0;if(core.platform.isOnline){window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;try{core.musicStatus.audioContext=new window.AudioContext();core.musicStatus.gainNode=core.musicStatus.audioContext.createGain();core.musicStatus.gainNode.connect(core.musicStatus.audioContext.destination)}catch(f){console.log("该浏览器不支持AudioContext");core.musicStatus.audioContext=null}}["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"].forEach(function(e){if(navigator.userAgent.indexOf(e)>=0){if(e=="iPhone"||e=="iPad"||e=="iPod"){core.platform.isIOS=true}if(e=="Android"){core.platform.isAndroid=true}core.platform.isPC=false}});try{core.platform.supportCopy=document.queryCommandSupported("copy")}catch(f){core.platform.supportCopy=false}var b=/Chrome\/(\d+)\./i.exec(navigator.userAgent);if(core.isset(b)&&parseInt(b[1])>=50){core.platform.isChrome=true}core.platform.isSafari=/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent);core.platform.isQQ=/QQ/i.test(navigator.userAgent);core.platform.isWeChat=/MicroMessenger/i.test(navigator.userAgent);core.platform.useLocalForage=core.getLocalStorage("useLocalForage",!core.platform.isIOS);if(core.platform.useLocalForage){try{core.setLocalForage("__test__",LZString.compress("__test__"),function(){try{core.getLocalForage("__test__",null,function(i){try{if(LZString.decompress(i)!="__test__"){console.log("localForage unsupported!");core.platform.useLocalForage=false}else{console.log("localForage supported!");core.removeLocalForage("__test__")}}catch(j){console.log(j);core.platform.useLocalForage=false}},function(i){console.log(i);core.platform.useLocalForage=false})}catch(h){console.log(h);core.platform.useLocalForage=false}},function(h){console.log(h);core.platform.useLocalForage=false})}catch(f){console.log(f);core.platform.useLocalForage=false}}if(window.FileReader){core.platform.fileReader=new FileReader();core.platform.fileReader.onload=function(){core.readFileContent(core.platform.fileReader.result)};core.platform.fileReader.onerror=function(){if(core.isset(core.platform.errorCallback)){core.platform.errorCallback()}}}if(core.platform.isPC){core.musicStatus.startDirectly=true}else{var c=navigator.connection;if(core.isset(c)&&c.type=="wifi"){core.musicStatus.startDirectly=true}}core.musicStatus.bgmStatus=core.getLocalStorage("bgmStatus",true);if(!core.musicStatus.startDirectly){core.musicStatus.bgmStatus=false}core.setLocalStorage("bgmStatus",core.musicStatus.bgmStatus);core.musicStatus.soundStatus=core.getLocalStorage("soundStatus",true);core.setLocalStorage("soundStatus",core.musicStatus.soundStatus);core.flags.battleAnimate=core.getLocalStorage("battleAnimate",core.flags.battleAnimate);core.flags.displayEnemyDamage=core.getLocalStorage("enemyDamage",core.flags.displayEnemyDamage);core.flags.displayCritical=core.getLocalStorage("critical",core.flags.displayCritical);core.flags.displayExtraDamage=core.getLocalStorage("extraDamage",core.flags.displayExtraDamage);core.flags.clickMoveDirectly=core.getLocalStorage("clickMoveDirectly",core.flags.clickMoveDirectly);core.material.ground=new Image();core.material.ground.src="project/images/ground.png";core.bigmap.tempCanvas=document.createElement("canvas").getContext("2d");core.loader.load(function(){console.log(core.material);core.material.icons.hero.height=core.material.images.hero.height/4;core.control.updateHeroIcon();core.initStatus.maps=core.maps.initMaps(core.floorIds);core.setRequestAnimationFrame();core.showStartAnimate();if(main.mode=="play"){core.events.initGame()}if(core.isset(functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a.plugins)){core.plugin=new functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a.plugins.plugin()}if(core.isset(a)){a()}})};core.prototype.setRequestAnimationFrame=function(){core.control.setRequestAnimationFrame()};core.prototype.showStartAnimate=function(a){core.control.showStartAnimate(a)};core.prototype.hideStartAnimate=function(a){core.control.hideStartAnimate(a)};core.prototype.isPlaying=function(){return core.control.isPlaying()};core.prototype.clearStatus=function(){core.control.clearStatus()};core.prototype.resetStatus=function(c,b,a,e,d,f){core.control.resetStatus(c,b,a,e,d,f)};core.prototype.startGame=function(b,a){core.control.startGame(b,a)};core.prototype.restart=function(){core.control.restart()};core.prototype.onkeyDown=function(a){return core.actions.onkeyDown(a)};core.prototype.onkeyUp=function(a){return core.actions.onkeyUp(a)};core.prototype.pressKey=function(a){return core.actions.pressKey(a)};core.prototype.keyDown=function(a){return core.actions.keyDown(a)};core.prototype.keyUp=function(a){return core.actions.keyUp(a)};core.prototype.ondown=function(a,b){return core.actions.ondown(a,b)};core.prototype.onmove=function(a,b){return core.actions.onmove(a,b)};core.prototype.onup=function(){return core.actions.onup()};core.prototype.getClickLoc=function(a,b){return core.actions.getClickLoc(a,b)};core.prototype.onclick=function(b,c,a){return core.actions.onclick(b,c,a)};core.prototype.onmousewheel=function(a){return core.actions.onmousewheel(a)};core.prototype.clearAutomaticRouteNode=function(a,b){core.control.clearAutomaticRouteNode(a,b)};core.prototype.stopAutomaticRoute=function(){core.control.stopAutomaticRoute()};core.prototype.continueAutomaticRoute=function(){core.control.continueAutomaticRoute()};core.prototype.clearContinueAutomaticRoute=function(){core.control.clearContinueAutomaticRoute()};core.prototype.setAutomaticRoute=function(a,b,c){core.control.setAutomaticRoute(a,b,c)};core.prototype.automaticRoute=function(a,b){return core.control.automaticRoute(a,b)};core.prototype.fillPosWithPoint=function(a){core.control.fillPosWithPoint(a)};core.prototype.setAutoHeroMove=function(a){core.control.setAutoHeroMove(a)};core.prototype.setHeroMoveInterval=function(b,c,d,a){core.control.setHeroMoveInterval(b,c,d,a)};core.prototype.moveAction=function(a){core.control.moveAction(a)};core.prototype.turnHero=function(a){core.control.turnHero(a)};core.prototype.canMoveHero=function(c,d,a,b){return core.maps.canMoveHero(c,d,a,b)};core.prototype.canMoveDirectly=function(a,b){return core.maps.canMoveDirectly(a,b)};core.prototype.moveHero=function(b,a){core.control.moveHero(b,a)};core.prototype.eventMoveHero=function(b,c,a){core.control.eventMoveHero(b,c,a)};core.prototype.jumpHero=function(b,c,d,a){core.control.jumpHero(b,c,d,a)};core.prototype.moveOneStep=function(){core.control.moveOneStep()};core.prototype.waitHeroToStop=function(a){core.control.waitHeroToStop(a)};core.prototype.stopHero=function(){core.control.stopHero()};core.prototype.drawHero=function(a,d,e,c,b){core.control.drawHero(a,d,e,c,b)};core.prototype.setHeroLoc=function(a,b,c){core.control.setHeroLoc(a,b,c)};core.prototype.getHeroLoc=function(a){return core.control.getHeroLoc(a)};core.prototype.nextX=function(a){return core.control.nextX(a)};core.prototype.nextY=function(a){return core.control.nextY(a)};core.prototype.openDoor=function(b,d,e,c,a){core.events.openDoor(b,d,e,c,a)};core.prototype.battle=function(c,d,e,b,a){core.events.battle(c,d,e,b,a)};core.prototype.afterBattle=function(b,c,d,a){core.events.afterBattle(b,c,d,a)};core.prototype.trigger=function(a,b){core.events.trigger(a,b)};core.prototype.changeFloor=function(b,e,d,f,a,c){core.events.changeFloor(b,e,d,f,a,c)};core.prototype.clearMap=function(b,d,e,c,a){core.ui.clearMap(b,d,e,c,a)};core.prototype.fillText=function(b,d,e,f,c,a){core.ui.fillText(b,d,e,f,c,a)};core.prototype.fillRect=function(b,e,f,d,a,c){core.ui.fillRect(b,e,f,d,a,c)};core.prototype.strokeRect=function(c,f,g,e,a,d,b){core.ui.strokeRect(c,f,g,e,a,d,b)};core.prototype.drawLine=function(b,d,f,e,g,c,a){core.ui.drawLine(b,d,f,e,g,c,a)};core.prototype.setFont=function(b,a){core.ui.setFont(b,a)};core.prototype.setLineWidth=function(b,a){core.ui.setLineWidth(b,a)};core.prototype.saveCanvas=function(a){core.ui.saveCanvas(a)};core.prototype.loadCanvas=function(a){core.ui.loadCanvas(a)};core.prototype.setStrokeStyle=function(a,b){core.ui.setStrokeStyle(a,b)};core.prototype.setAlpha=function(b,a){core.ui.setAlpha(b,a)};core.prototype.setOpacity=function(a,b){core.ui.setOpacity(a,b)};core.prototype.setFillStyle=function(a,b){core.ui.setFillStyle(a,b)};core.prototype.drawBlock=function(b,a,c,d){core.maps.drawBlock(b,a,c,d)};core.prototype.drawMap=function(b,a){core.maps.drawMap(b,a)};core.prototype.drawAutotile=function(b,d,a,e,c,f){core.maps.drawAutotile(b,d,a,e,c,f)};core.prototype.noPassExists=function(b,c,a){return core.maps.noPassExists(b,c,a)};core.prototype.noPass=function(a,b){return core.maps.noPass(a,b)};core.prototype.npcExists=function(b,c,a){return core.maps.npcExists(b,c,a)};core.prototype.terrainExists=function(c,d,b,a){return core.maps.terrainExists(c,d,b,a)};core.prototype.stairExists=function(b,c,a){return core.maps.stairExists(b,c,a)};core.prototype.nearStair=function(){return core.maps.nearStair()};core.prototype.enemyExists=function(c,d,b,a){return core.maps.enemyExists(c,d,b,a)};core.prototype.getBlock=function(c,d,a,b){return core.maps.getBlock(c,d,a,b)};core.prototype.getBlockId=function(c,d,a,b){return core.maps.getBlockId(c,d,a,b)};core.prototype.getBlockCls=function(c,d,a,b){return core.maps.getBlockCls(c,d,a,b)};core.prototype.moveBlock=function(e,f,c,d,b,a){core.maps.moveBlock(e,f,c,d,b,a)};core.prototype.jumpBlock=function(e,f,b,c,g,d,a){core.maps.jumpBlock(e,f,b,c,g,d,a)};core.prototype.animateBlock=function(b,d,c,a){core.maps.animateBlock(b,d,c,a)};core.prototype.showBlock=function(b,c,a){core.maps.showBlock(b,c,a)};core.prototype.hideBlock=function(b,c,a){core.maps.hideBlock(b,c,a)};core.prototype.removeBlock=function(b,c,a){core.maps.removeBlock(b,c,a)};core.prototype.removeBlockById=function(b,a){core.maps.removeBlockById(b,a)};core.prototype.removeBlockByIds=function(a,b){core.maps.removeBlockByIds(a,b)};core.prototype.setBlock=function(b,c,d,a){core.maps.setBlock(b,c,d,a)};core.prototype.setBgFgBlock=function(b,c,d,e,a){core.maps.setBgFgBlock(b,c,d,e,a)};core.prototype.addGlobalAnimate=function(a){core.maps.addGlobalAnimate(a)};core.prototype.removeGlobalAnimate=function(b,c,a){core.maps.removeGlobalAnimate(b,c,a)};core.prototype.setGlobalAnimate=function(a){core.maps.setGlobalAnimate(a)};core.prototype.syncGlobalAnimate=function(){core.maps.syncGlobalAnimate()};core.prototype.drawBoxAnimate=function(){core.maps.drawBoxAnimate()};core.prototype.drawAnimate=function(b,c,d,a){core.maps.drawAnimate(b,c,d,a)};core.prototype.updateCheckBlock=function(){core.control.updateCheckBlock()};core.prototype.checkBlock=function(){core.control.checkBlock()};core.prototype.snipe=function(a){core.control.snipe(a)};core.prototype.setWeather=function(b,a){core.control.setWeather(b,a)};core.prototype.setFg=function(b,c,a){core.control.setFg(b,c,a)};core.prototype.updateDamage=function(){core.control.updateDamage()};core.prototype.hasSpecial=function(a,b){return core.enemys.hasSpecial(a,b)};core.prototype.canBattle=function(a,c,d,b){return core.enemys.canBattle(a,c,d,b)};core.prototype.getDamage=function(a,c,d,b){return core.enemys.getDamage(a,c,d,b)};core.prototype.itemCount=function(a){return core.items.itemCount(a)};core.prototype.hasItem=function(a){return core.items.hasItem(a)};core.prototype.hasEquip=function(a){return core.items.hasEquip(a)};core.prototype.getEquip=function(a){return core.items.getEquip(a)};core.prototype.setItem=function(a,b){core.items.setItem(a,b)};core.prototype.removeItem=function(a,b){return core.items.removeItem(a,b)};core.prototype.useItem=function(b,a){core.items.useItem(b,a)};core.prototype.canUseItem=function(a){return core.items.canUseItem(a)};core.prototype.loadEquip=function(b,a){core.items.loadEquip(b,a)};core.prototype.unloadEquip=function(b,a){core.items.unloadEquip(b,a)};core.prototype.compareEquipment=function(b,a){return core.items.compareEquipment(b,a)};core.prototype.addItem=function(a,b){core.items.addItem(a,b)};core.prototype.getNextItem=function(){return core.events.getNextItem()};core.prototype.getItem=function(b,c,d,e,a){core.events.getItem(b,c,d,e,a)};core.prototype.drawTip=function(b,a){core.ui.drawTip(b,a)};core.prototype.drawText=function(b,a){core.ui.drawText(b,a)};core.prototype.replaceText=function(a){return core.utils.replaceText(a)};core.prototype.calValue=function(a){return core.utils.calValue(a)};core.prototype.doEffect=function(a){core.control.doEffect(a)};core.prototype.splitLines=function(a,d,c,b){return core.utils.splitLines(a,d,c,b)};core.prototype.unshift=function(c,d){return core.utils.unshift(c,d)};core.prototype.setLocalStorage=function(a,b){return core.utils.setLocalStorage(a,b)};core.prototype.getLocalStorage=function(b,a){return core.utils.getLocalStorage(b,a)};core.prototype.removeLocalStorage=function(a){core.utils.removeLocalStorage(a)};core.prototype.setLocalForage=function(b,d,c,a){core.utils.setLocalForage(b,d,c,a)};core.prototype.getLocalForage=function(c,a,d,b){core.utils.getLocalForage(c,a,d,b)};core.prototype.removeLocalForage=function(b,c,a){core.utils.removeLocalForage(b,c,a)};core.prototype.clone=function(a){return core.utils.clone(a)};core.prototype.cropImage=function(a,b){return core.utils.cropImage(a,b)};core.prototype.formatDate=function(a){return core.utils.formatDate(a)};core.prototype.formatDate2=function(a){return core.utils.formatDate2(a)};core.prototype.formatBigNumber=function(a){return core.utils.formatBigNumber(a)};core.prototype.setTwoDigits=function(a){return core.utils.setTwoDigits(a)};core.prototype.arrayToRGB=function(a){return core.utils.arrayToRGB(a)};core.prototype.debug=function(){core.control.debug()};core.prototype.beforeSaveData=function(a){return core.events.beforeSaveData(a)};core.prototype.afterLoadData=function(a){return core.events.afterLoadData(a)};core.prototype.resetMap=function(a){core.maps.resetMap(a)};core.prototype.startReplay=function(a){core.control.startReplay(a)};core.prototype.closePanel=function(){core.ui.closePanel()};core.prototype.triggerReplay=function(){core.control.triggerReplay()};core.prototype.pauseReplay=function(){core.control.pauseReplay()};core.prototype.resumeReplay=function(){core.control.resumeReplay()};core.prototype.speedUpReplay=function(){core.control.speedUpReplay()};core.prototype.speedDownReplay=function(){core.control.speedDownReplay()};core.prototype.setReplaySpeed=function(a){core.control.setReplaySpeed(a)};core.prototype.rewindReplay=function(){core.control.rewindReplay()};core.prototype.stopReplay=function(){core.control.stopReplay()};core.prototype.saveReplay=function(){core.control.saveReplay()};core.prototype.bookReplay=function(){core.control.bookReplay()};core.prototype.viewMapReplay=function(){core.control.viewMapReplay()};core.prototype.replay=function(){core.control.replay()};core.prototype.checkStatus=function(b,c,a){return core.control.checkStatus(b,c,a)};core.prototype.openBook=function(a){core.control.openBook(a)};core.prototype.useFly=function(a){core.control.useFly(a)};core.prototype.openEquipbox=function(a){core.control.openEquipbox(a)};core.prototype.openToolbox=function(a){core.control.openToolbox(a)};core.prototype.openQuickShop=function(a){core.control.openQuickShop(a)};core.prototype.save=function(a){core.control.save(a)};core.prototype.load=function(a){core.control.load(a)};core.prototype.openSettings=function(a){core.control.openSettings(a)};core.prototype.autosave=function(a){core.control.autosave(a)};core.prototype.doSL=function(a,b){core.control.doSL(a,b)};core.prototype.syncSave=function(a){core.control.syncSave(a)};core.prototype.syncLoad=function(){core.control.syncLoad()};core.prototype.saveData=function(){return core.control.saveData()};core.prototype.loadData=function(b,a){core.control.loadData(b,a)};core.prototype.encodeRoute=function(a){return core.utils.encodeRoute(a)};core.prototype.decodeRoute=function(a){return core.utils.decodeRoute(a)};core.prototype.http=function(f,g,b,e,a,c,d){core.utils.http(f,g,b,e,a,c,d)};core.prototype.setStatus=function(a,b){core.control.setStatus(a,b)};core.prototype.getStatus=function(a){return core.control.getStatus(a)};core.prototype.getLvName=function(){return core.control.getLvName()};core.prototype.setFlag=function(a,b){core.control.setFlag(a,b)};core.prototype.getFlag=function(b,a){return core.control.getFlag(b,a)};core.prototype.hasFlag=function(a){return core.control.hasFlag(a)};core.prototype.doAction=function(){core.events.doAction()};core.prototype.insertAction=function(b,c,d,a){core.events.insertAction(b,c,d,a)};core.prototype.lockControl=function(){core.control.lockControl()};core.prototype.unLockControl=function(){core.control.unLockControl()};core.prototype.isset=function(a){return core.utils.isset(a)};core.prototype.subarray=function(c,d){return core.utils.subarray(c,d)};core.prototype.clamp=function(e,c,d){return core.utils.clamp(e,c,d)};core.prototype.encodeBase64=function(a){return core.utils.encodeBase64(a)};core.prototype.decodeBase64=function(a){return core.utils.decodeBase64(a)};core.prototype.rand=function(a){return core.utils.rand(a)};core.prototype.rand2=function(a){return core.utils.rand2(a)};core.prototype.readFile=function(c,a,b){core.utils.readFile(c,a,b)};core.prototype.readFileContent=function(a){core.utils.readFileContent(a)};core.prototype.download=function(b,a){core.utils.download(b,a)};core.prototype.copy=function(a){return core.utils.copy(a)};core.prototype.playBgm=function(a){core.control.playBgm(a)};core.prototype.pauseBgm=function(){core.control.pauseBgm()};core.prototype.resumeBgm=function(){core.control.resumeBgm()};core.prototype.playSound=function(a){core.control.playSound(a)};core.prototype.show=function(b,c,a){core.utils.show(b,c,a)};core.prototype.hide=function(b,c,a){core.utils.hide(b,c,a)};core.prototype.clearStatusBar=function(){core.control.clearStatusBar()};core.prototype.updateStatusBar=function(){core.control.updateStatusBar()};core.prototype.resize=function(b,a){core.control.resize(b,a)};core.prototype.domRenderer=function(){core.control.domRenderer()};var core=new core();